name: HDFilmCehennemi Film Scraper

on:
  schedule:
    - cron: '0 8 * * *'

  workflow_dispatch:
    inputs:
      pages:
        description: 'KaÃ§ sayfa taranacak?'
        required: false
        default: '5'
      delay:
        description: 'Filmler arasÄ± bekleme (saniye)'
        required: false
        default: '0.5'

jobs:
  scrape-films:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        pip install requests beautifulsoup4
        
    - name: Set Variables
      id: vars
      run: |
        # workflow_dispatch ise inputs kullan
        # schedule ise default deÄŸerlere dÃ¼ÅŸ
        if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
          echo "PAGES=${{ github.event.inputs.pages }}" >> $GITHUB_ENV
          echo "DELAY=${{ github.event.inputs.delay }}" >> $GITHUB_ENV
        else
          echo "PAGES=5" >> $GITHUB_ENV
          echo "DELAY=0.5" >> $GITHUB_ENV
        fi

    - name: Run Film Scraper
      run: |
        echo "ðŸ“… Scraping started at: $(date)"
        echo "ðŸ“Š Pages to scrape: $PAGES"
        echo "â±ï¸ Delay between films: $DELAY seconds"
        python hdfilmcehennemi.py "$PAGES" "$DELAY"
        
    - name: Commit and Push Changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        if git diff --name-only | grep -q "hdfilmcehennemi.html"; then
          git add hdfilmcehennemi.html
          git commit -m "ðŸ¤– Auto-update: Film data refreshed"
          git push
        else
          echo "âš ï¸ No changes in HTML file, skipping commit"
        fi
        
    - name: Create Summary
      if: always()
      run: |
        echo "## ðŸŽ¬ HDFilmCehennemi Scraping Summary" >> $GITHUB_STEP_SUMMARY
        echo "- **Scraping Time:** $(date '+%Y-%m-%d %H:%M:%S')" >> $GITHUB_STEP_SUMMARY
        echo "- **Pages Scraped:** $PAGES" >> $GITHUB_STEP_SUMMARY
        echo "- **Delay Between Films:** $DELAY seconds" >> $GITHUB_STEP_SUMMARY
        if [ -f "hdfilmcehennemi.html" ]; then
          FILESIZE=$(stat -c%s "hdfilmcehennemi.html")
          echo "- **HTML File Size:** $((FILESIZE / 1024)) KB" >> $GITHUB_STEP_SUMMARY
        fi
