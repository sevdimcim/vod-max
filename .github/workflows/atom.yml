name: Atom Sayfa KaynaÄŸÄ±nÄ± Otomatik Al

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */3 * * *'
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

permissions:
  contents: write
  actions: read
  checks: write

jobs:
  sayfa-kaydet:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
    - name: ðŸ“¥ Repoyu Klonla
      uses: actions/checkout@v3
      with:
        fetch-depth: 1
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: ðŸ“… Tarih Bilgisi
      id: date
      run: |
        echo "TR_SAAT=$(TZ='Europe/Istanbul' date '+%Y-%m-%d %H:%M:%S')" >> $GITHUB_ENV
        echo "UTC_SAAT=$(date -u '+%Y-%m-%d %H:%M:%S')" >> $GITHUB_ENV
    
    - name: ðŸ Python Kur
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ðŸ“¦ Paketleri YÃ¼kle
      run: |
        python -m pip install --upgrade pip
        pip install requests brotli
    
    - name: ðŸš€ BetiÄŸi Ã‡alÄ±ÅŸtÄ±r
      id: run_script
      run: |
        echo "ðŸ•’ BaÅŸlangÄ±Ã§: ${{ env.TR_SAAT }}"
        python atom.py 2>&1 | tee script_output.txt
        
        if [ ${PIPESTATUS[0]} -eq 0 ]; then
          echo "status=success" >> $GITHUB_OUTPUT
        else
          echo "status=failed" >> $GITHUB_OUTPUT
        fi
      continue-on-error: true
    
    - name: ðŸ“‚ DosyalarÄ± Kontrol Et
      run: |
        echo "## ðŸ“ Dizin iÃ§eriÄŸi" >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
        ls -la >> $GITHUB_STEP_SUMMARY
        echo '```' >> $GITHUB_STEP_SUMMARY
    
    - name: ðŸ’¾ DeÄŸiÅŸiklikleri Kaydet
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        # DeÄŸiÅŸiklikleri ekle
        git add atom.txt script_output.txt 2>/dev/null || true
        
        # Commit oluÅŸtur
        git commit -m "ðŸ¤– Otomatik gÃ¼ncelleme: ${{ env.TR_SAAT }}" || echo "DeÄŸiÅŸiklik yok"
    
    - name: ðŸ“¤ GitHub'a GÃ¶nder (Force Push)
      uses: ad-m/github-push-action@v0.8.0
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        branch: ${{ github.ref }}
        force: true  # Force push aktif!
        directory: '.'
